@page "/contacts/create"
@attribute [Authorize]

<HtmxAppPage>
    <HtmxPageTitle>Create contact</HtmxPageTitle>
    <h1 class="mb-8 text-3xl font-bold">
        <a class="text-blue-500 hover:text-blue-600" href="/contacts">
            Contacts
        </a>
        <span class="text-blue-500 font-medium">/</span>
        Create
    </h1>

    <div class="max-w-3xl bg-white rounded-md shadow overflow-hidden">
        <h2 class="text-lg font-semibold pt-8 pl-8">Create Contact</h2>
        <EditForm method="post" Model="Model" OnValidSubmit="CreateContact" FormName="CreateContact" hx-headers='{"HX-RETARGET":"main"}'>
            <DataAnnotationsValidator/>
            <div class="flex flex-wrap -mb-8 -mr-6 p-8">
                <div class="pb-8 pr-6 w-full lg:w-1/2 space-y-2">
                    <label for="name">Name</label>
                    <InputText id="name" @bind-Value="Model.Name" class="relative px-6 py-3 w-full rounded border-gray-300 border-2"/>
                    <ValidationMessage For="() => Model.Name"/>
                </div>
                <div class="pb-8 pr-6 w-full lg:w-1/2 space-y-2">
                    <label for="email">Email</label>
                    <InputText type="text" id="email" @bind-Value="Model.Email" class="relative px-6 py-3 w-full rounded border-gray-300 border-2"/>
                    <ValidationMessage For="() => Model.Email"/>
                </div>
                <div class="pb-8 pr-6 w-full lg:w-1/2 space-y-2">
                    <label for="city">City</label>
                    <InputText id="city" @bind-Value="Model.City" class="relative px-6 py-3 w-full rounded border-gray-300 border-2"/>
                    <ValidationMessage For="() => Model.City"/>
                </div>
                <div class="pb-8 pr-6 w-full lg:w-1/2 space-y-2">
                    <label for="phone">Phone</label>
                    <InputText id="phone" @bind-Value="Model.Phone" class="relative px-6 py-3 w-full rounded border-gray-300 border-2"/>
                    <ValidationMessage For="() => Model.Phone"/>
                </div>
            </div>
            <div class="flex items-center justify-end px-8 py-4 bg-gray-50 border-t border-gray-100">
                <button class="px-4 py-2 font-medium rounded bg-blue-500 hover:bg-blue-600 text-white transition" type="submit">
                    Save
                </button>
            </div>
        </EditForm>
    </div>
</HtmxAppPage>

@code {
    [SupplyParameterFromForm] public Contact Model { get; set; } = new();

    [CascadingParameter] private HttpContext Context { get; set; }

    [Inject] private NavigationManager Nav { get; set; }
    [Inject] private AppDbContext AppDbContext { get; set; }

    public async Task CreateContact()
    {
        var entry = await AppDbContext.Contacts.AddAsync(Model);
        await AppDbContext.SaveChangesAsync();

        Nav.NavigateTo($"/contacts");
    }

}